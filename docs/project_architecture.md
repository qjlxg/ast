# AGAnalysisAI 项目架构文档

## 项目概述

AGAnalysisAI 是一个基于AI的股票分析和交易决策系统。该系统模拟了一个对冲基金的运作方式，利用多个"AI分析师"（专家代理）分析股票数据，并根据分析结果提供交易建议。目前该系统主要针对美股市场，通过提供的API获取金融数据并进行分析。

## 技术架构

### 核心组件

1. **代理系统（Agents）**：
   - 多个模拟不同投资风格的AI分析师（如Warren Buffett、Ben Graham等）
   - 风险管理代理（Risk Manager）
   - 投资组合管理代理（Portfolio Manager）

2. **图处理引擎（Graph）**：
   - 使用LangGraph创建代理工作流
   - 管理代理之间的数据流和交互

3. **数据处理（Data）**：
   - 数据模型定义（使用Pydantic）
   - 缓存机制

4. **工具（Tools）**：
   - API接口，用于获取金融数据
   - 数据转换工具

5. **LLM集成**：
   - 支持多种大语言模型（如GPT-4等）
   - 处理模型响应和推理

6. **辅助工具（Utils）**：
   - 可视化
   - 进度跟踪
   - 结果展示

### 数据流

1. 用户提供股票代码、日期范围和其他配置参数
2. 系统根据选定的AI分析师创建工作流
3. 各个分析师代理从API获取相关数据并进行分析
4. 分析结果传递给风险管理代理进行风险评估
5. 投资组合管理代理整合所有分析，生成最终的交易决策
6. 系统返回分析结果和交易建议

## 功能模块

### 1. 代理模块（Agents）

每个代理代表一种特定的投资风格或分析视角：

- **Warren Buffett**：价值投资，关注公司内在价值和护城河
- **Ben Graham**：防御性价值投资，关注安全边际
- **技术分析（Technicals）**：基于价格和成交量的技术指标分析
- **基本面分析（Fundamentals）**：公司财务指标分析
- **风险管理（Risk Management）**：评估各种投资风险和合适的仓位大小
- **投资组合管理（Portfolio Management）**：整合各种信号，做出最终决策

### 2. 数据获取模块

- 通过API获取价格数据、财务指标、公司新闻等
- 支持数据缓存，提高性能
- 数据模型定义（使用Pydantic）确保数据一致性

### 3. 分析逻辑模块

各个代理实现了不同的分析方法：
- 估值分析
- 基本面分析
- 技术指标分析
- 情绪分析
- 风险评估

### 4. 决策系统

- 整合各个分析师的观点
- 生成最终的交易信号（看涨/看跌/中性）
- 确定合适的仓位大小

## 系统规则

### 投资决策规则

1. **信号生成**：
   - 每个分析师根据自己的分析方法生成看涨(bullish)、看跌(bearish)或中性(neutral)信号
   - 信号包含置信度(confidence)和推理过程(reasoning)

2. **风险管理规则**：
   - 基于分析师信号的集中度评估风险
   - 确定合适的最大仓位比例

3. **投资组合规则**：
   - 整合所有分析师信号
   - 考虑当前市场状况和投资组合现状
   - 生成最终的交易决策（买入/卖出/持有）和仓位大小

### 分析师特定规则

1. **Warren Buffett分析规则**：
   - 评估公司基本面（ROE>15%、负债率低等）
   - 分析护城河（竞争优势）
   - 计算内在价值和安全边际
   - 评估管理层质量

2. **技术分析规则**：
   - 移动平均线分析
   - 相对强弱指标(RSI)
   - MACD指标
   - 成交量分析

3. **基本面分析规则**：
   - 盈利增长率
   - 估值比率（P/E、P/B等）
   - 利润率
   - 财务稳健性 