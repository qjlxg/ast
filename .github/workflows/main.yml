name: Run Right Side Pattern Scanner

on:
  push:
    paths:
      - 'right_side_pattern.py'  # è„šæœ¬å˜åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
      - '.github/workflows/main.yml' # å·¥ä½œæµå˜åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
      # æ³¨æ„ï¼šå¦‚æœ stock_data/ ç›®å½•å†…å®¹å˜åŠ¨ä¹Ÿéœ€è¦è‡ªåŠ¨è¿è¡Œï¼Œè¯·æ·»åŠ : - 'stock_data/**'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  scan_stocks:
    runs-on: ubuntu-latest
    
    # æ­¥éª¤ç¯å¢ƒå˜é‡ï¼Œç”¨äº Git é…ç½®å’Œ Python è·¯å¾„
    env:
      PYTHON_VERSION: '3.x'
      GIT_AUTHOR_NAME: 'GitHub Actions Bot'
      GIT_AUTHOR_EMAIL: 'actions@github.com'
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # è·å–å…¨éƒ¨å†å²è®°å½•ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„ Git æ“ä½œ
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Install dependencies
      run: |
        # å®‰è£… pandas å’Œ pytz åº“
        python -m pip install --upgrade pip
        pip install pandas pytz
        
    # **å·²ç§»é™¤æ¨¡æ‹Ÿæ•°æ®åˆ›å»ºæ­¥éª¤**
        
    - name: Run Pattern Scanner Script
      # è®¾ç½®æ—¶åŒºç¯å¢ƒå˜é‡ (Linux ç³»ç»Ÿ)
      run: |
        export TZ='Asia/Shanghai'
        python right_side_pattern.py

    - name: Configure Git
      run: |
        git config --global user.email "${{ env.GIT_AUTHOR_EMAIL }}"
        git config --global user.name "${{ env.GIT_AUTHOR_NAME }}"

    - name: Commit and Push Results
      # æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ç»“æœæ–‡ä»¶ç”Ÿæˆï¼Œå¦‚æœæœ‰åˆ™æäº¤å¹¶æ¨é€
      run: |
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŒ–ï¼ˆåŒ…æ‹¬æ–°ç”Ÿæˆçš„ç»“æœæ–‡ä»¶ï¼‰
        if [[ $(git status --porcelain=v1 results) ]]; then
          echo "æ£€æµ‹åˆ°æ–°çš„ç»“æœæ–‡ä»¶ï¼Œæ­£åœ¨æäº¤..."
          git add results
          git commit -m "ğŸ¤– Auto: Add new right side pattern scan results - $(date +%Y-%m-%d %H:%M:%S)"
          git push
        else
          echo "æœªå‘ç°æ–°çš„ç¬¦åˆæ¨¡å¼çš„è‚¡ç¥¨ç»“æœï¼Œæ— éœ€æäº¤ã€‚"
        fi
